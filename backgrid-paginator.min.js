/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
  Licensed under the MIT @license.
*/
(function(e,t){if(typeof exports=="object"){module.exports=t(require("underscore"),require("backbone"),require("backgrid"),require("backbone-pageable"))}else{t(e._,e.Backbone,e.Backgrid)}})(this,function(e,t,n){"use strict";var r=n.Extension.PageHandle=t.View.extend({tagName:"li",events:{"click a":"changePage"},title:e.template("Page <%- label %>",null,{variable:null}),isRewind:false,isBack:false,isForward:false,isFastForward:false,initialize:function(t){var n=this.collection;var r=n.state;var i=r.currentPage;var s=r.firstPage;var o=r.lastPage;e.extend(this,e.pick(t,["isRewind","isBack","isForward","isFastForward"]));var u;if(this.isRewind)u=s;else if(this.isBack)u=Math.max(s,i-1);else if(this.isForward)u=Math.min(o,i+1);else if(this.isFastForward)u=o;else{u=+t.pageIndex;u=s?u+1:u}this.pageIndex=u;this.label=(t.label||(s?u:u+1))+"";var a=t.title||this.title;this.title=e.isFunction(a)?a({label:this.label}):a},render:function(){this.$el.empty();var e=document.createElement("a");e.href="#";if(this.title)e.title=this.title;e.innerHTML=this.label;this.el.appendChild(e);var t=this.collection;var n=t.state;var r=n.currentPage;var i=this.pageIndex;if(this.isRewind&&r==n.firstPage||this.isBack&&!t.hasPrevious()||this.isForward&&!t.hasNext()||this.isFastForward&&(r==n.lastPage||n.totalPages<1)){this.$el.addClass("disabled")}else if(!(this.isRewind||this.isBack||this.isForward||this.isFastForward)&&n.currentPage==i){this.$el.addClass("active")}this.delegateEvents();return this},changePage:function(e){e.preventDefault();var t=this.$el,n=this.collection;if(!t.hasClass("active")&&!t.hasClass("disabled")){if(this.isRewind)n.getFirstPage();else if(this.isBack)n.getPreviousPage();else if(this.isForward)n.getNextPage();else if(this.isFastForward)n.getLastPage();else n.getPage(this.pageIndex,{reset:true})}return this}});var i=n.Extension.Paginator=t.View.extend({className:"backgrid-paginator",windowSize:10,slideScale:.5,controls:{rewind:{label:"&laquo;",title:"First"},back:{label:"&#8249;",title:"Previous"},forward:{label:"&#8250;",title:"Next"},fastForward:{label:"&#187;",title:"Last"}},renderIndexedPageHandles:true,pageHandle:r,goBackFirstOnSort:true,initialize:function(t){var n=this;n.controls=e.defaults(t.controls||{},n.controls,i.prototype.controls);e.extend(n,e.pick(t||{},"windowSize","pageHandle","slideScale","goBackFirstOnSort","renderIndexedPageHandles"));var r=n.collection;n.listenTo(r,"add",n.render);n.listenTo(r,"remove",n.render);n.listenTo(r,"reset",n.render);n.listenTo(r,"backgrid:sorted",function(){if(n.goBackFirstOnSort)r.getFirstPage({reset:true})})},slideMaybe:function(e,t,n,r,i){return Math.round(n%r/r)},slideThisMuch:function(e,t,n,r,i){return~~(r*i)},_calculateWindow:function(){var e=this.collection;var t=e.state;var n=t.firstPage;var r=+t.lastPage;r=Math.max(0,n?r-1:r);var i=Math.max(t.currentPage,t.firstPage);i=n?i-1:i;var s=this.windowSize;var o=this.slideScale;var u=Math.floor(i/s)*s;if(i<=r-this.slideThisMuch()){u+=this.slideMaybe(n,r,i,s,o)*this.slideThisMuch(n,r,i,s,o)}var a=Math.min(r+1,u+s);return[u,a]},makeHandles:function(){var t=[];var n=this.collection;var r=this._calculateWindow();var i=r[0],s=r[1];if(this.renderIndexedPageHandles){for(var o=i;o<s;o++){t.push(new this.pageHandle({collection:n,pageIndex:o}))}}var u=this.controls;e.each(["back","rewind","forward","fastForward"],function(e){var r=u[e];if(r){var i={collection:n,title:r.title,label:r.label};i["is"+e.slice(0,1).toUpperCase()+e.slice(1)]=true;var s=new this.pageHandle(i);if(e=="rewind"||e=="back")t.unshift(s);else t.push(s)}},this);return t},render:function(){this.$el.empty();if(this.handles){for(var e=0,t=this.handles.length;e<t;e++){this.handles[e].remove()}}var n=this.handles=this.makeHandles();var r=document.createElement("ul");for(var e=0;e<n.length;e++){r.appendChild(n[e].render().el)}this.el.appendChild(r);return this}})})
